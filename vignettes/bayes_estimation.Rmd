---
title: "Bayes estimation"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Bayes estimation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r include = FALSE}
library(knitr)

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


## Input dataset

```{r}
library(here)
library(tibble)
library(readr)

readRDS(here("dev/counts.rds"))

```

## Create input and infer

In this test run, we are using data for only 2 cell types, which are - 2 NK cell subtypes- CD56bright NK and CD56dim NK cells.

```{bash, eval=FALSE}

Rscript dev/modeling_code/create_input.R dev/counts.rds dev/modeling_results dev/tree_kamran.yaml
```

## Makeflow installation and loading

Source https://cctools.readthedocs.io/en/latest/install/

```{bash, eval=FALSE}
module load miniconda3
conda create -n cctools-env -y -c conda-forge --strict-channel-priority python ndcctools
conda activate cctools-env

# When done
conda deactivate

```

```{bash, eval=FALSE}
# Run
conda activate cctools-env
makeflow -T slurm -J 200  dev/modeling_results/run_model.makeflow

# Monitor
makeflow_monitor dev/modeling_results/run_model.makeflow.makeflowlog
```

